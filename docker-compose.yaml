version: '3.8'

services:
  # TxHammer stress testing tool
  txhammer:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VERSION: ${VERSION:-dev}
        COMMIT: ${COMMIT:-local}
        BUILD_DATE: ${BUILD_DATE:-unknown}
    image: txhammer:latest
    container_name: txhammer
    volumes:
      - ./reports:/app/reports
    environment:
      - RPC_URL=${RPC_URL:-http://anvil:8545}
    networks:
      - txhammer-net
    # Override entrypoint for interactive use
    # command: ["--help"]

  # Local EVM node for testing (Foundry Anvil)
  anvil:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: anvil
    ports:
      - "8545:8545"
    entrypoint: ["anvil", "--host", "0.0.0.0"]
    networks:
      - txhammer-net
    healthcheck:
      test: ["CMD", "cast", "block-number", "--rpc-url", "http://localhost:8545"]
      interval: 5s
      timeout: 5s
      retries: 5

networks:
  txhammer-net:
    driver: bridge
